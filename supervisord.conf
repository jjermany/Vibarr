[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

; ── PostgreSQL ──
[program:postgresql]
command=/usr/lib/postgresql/15/bin/postgres -D /config/postgresql -k /var/run/postgresql
user=postgres
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=10

; ── Redis ──
[program:redis]
command=redis-server --dir /config/redis --daemonize no --bind 127.0.0.1 --port 6379
user=redis
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=10

; ── FastAPI Backend ──
[program:backend]
command=uvicorn app.main:app --host 0.0.0.0 --port 8000
directory=/app/backend
user=vibarr
environment=HOME="/home/vibarr",PGSSLMODE="disable"
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
startsecs=5
startretries=10
priority=20

; ── Celery Worker ──
[program:celery-worker]
command=celery -A app.celery_app worker --loglevel=info
directory=/app/backend
user=vibarr
environment=HOME="/home/vibarr",PGSSLMODE="disable"
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
startsecs=10
startretries=10
priority=30

; ── Celery Beat (Scheduler) ──
[program:celery-beat]
command=celery -A app.celery_app beat --loglevel=info
directory=/app/backend
user=vibarr
environment=HOME="/home/vibarr",PGSSLMODE="disable"
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
startsecs=10
startretries=10
priority=30

; ── Next.js Frontend ──
[program:frontend]
command=node server.js
directory=/app/frontend
user=vibarr
environment=PORT=3000,HOSTNAME="0.0.0.0"
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=20
